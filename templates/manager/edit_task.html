{% extends 'base.html' %}
{% block title %}Edit Task{% endblock %}

{% block content %}
<style>
  .edit-task-container {
    max-width: 800px;
    margin: 0 auto;
    padding: 20px;
  }

  .page-header {
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    color: white;
    padding: 30px;
    border-radius: 20px 20px 0 0;
    margin-bottom: 0;
    text-align: center;
    position: relative;
    overflow: hidden;
  }

  .page-header::before {
    content: '';
    position: absolute;
    top: -50%;
    left: -50%;
    width: 200%;
    height: 200%;
    background: radial-gradient(circle, rgba(255,255,255,0.1) 0%, transparent 70%);
    animation: shimmer 3s ease-in-out infinite;
  }

  @keyframes shimmer {
    0%, 100% { transform: translateX(-100%) translateY(-100%); }
    50% { transform: translateX(-50%) translateY(-50%); }
  }

  .page-title {
    font-size: 32px;
    font-weight: 700;
    margin: 0;
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 12px;
    position: relative;
    z-index: 1;
  }

  .form-card {
    background: white;
    border-radius: 0 0 20px 20px;
    padding: 40px;
    box-shadow: 0 20px 40px rgba(0,0,0,0.1);
    border: 1px solid #e2e8f0;
    border-top: none;
  }

  .form-grid {
    display: grid;
    gap: 25px;
  }

  .form-group {
    position: relative;
  }

  .form-group label {
    display: block;
    font-weight: 600;
    margin-bottom: 8px;
    color: #374151;
    font-size: 14px;
    text-transform: uppercase;
    letter-spacing: 0.5px;
  }

  .form-control {
    width: 100%;
    padding: 16px 20px;
    border: 2px solid #e2e8f0;
    border-radius: 12px;
    font-size: 16px;
    transition: all 0.3s ease;
    background: #f8fafc;
    font-family: inherit;
  }

  .form-control:focus {
    outline: none;
    border-color: #667eea;
    background: white;
    box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
    transform: translateY(-2px);
  }

  .form-control:hover {
    border-color: #cbd5e1;
    background: white;
  }

  textarea.form-control {
    resize: vertical;
    min-height: 120px;
    font-family: inherit;
    line-height: 1.6;
  }

  .form-row {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 20px;
  }

  .priority-select, .status-select {
    position: relative;
  }

  .priority-select select, .status-select select {
    appearance: none;
    background-image: url("data:image/svg+xml;charset=UTF-8,%3csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' fill='none' stroke='currentColor' stroke-width='2' stroke-linecap='round' stroke-linejoin='round'%3e%3cpolyline points='6,9 12,15 18,9'%3e%3c/polyline%3e%3c/svg%3e");
    background-repeat: no-repeat;
    background-position: right 16px center;
    background-size: 20px;
    padding-right: 50px;
  }

  .priority-indicator {
    position: absolute;
    top: 50%;
    right: 50px;
    transform: translateY(-50%);
    width: 12px;
    height: 12px;
    border-radius: 50%;
    pointer-events: none;
  }

  .priority-low { background-color: #10b981; }
  .priority-medium { background-color: #f59e0b; }
  .priority-high { background-color: #ef4444; }
  .priority-critical { background-color: #dc2626; animation: pulse 2s infinite; }

  @keyframes pulse {
    0%, 100% { opacity: 1; }
    50% { opacity: 0.5; }
  }

  .status-indicator {
    position: absolute;
    top: 50%;
    right: 50px;
    transform: translateY(-50%);
    width: 12px;
    height: 12px;
    border-radius: 50%;
    pointer-events: none;
  }

  .status-to_do { background-color: #64748b; }
  .status-in_progress { background-color: #f59e0b; }
  .status-completed { background-color: #10b981; }
  .status-failed { background-color: #ef4444; }

  .date-input-wrapper {
    position: relative;
  }

  .date-input-wrapper::before {
    content: 'üìÖ';
    position: absolute;
    right: 16px;
    top: 50%;
    transform: translateY(-50%);
    pointer-events: none;
    font-size: 18px;
  }

  .btn-container {
    margin-top: 40px;
    display: flex;
    gap: 15px;
    justify-content: center;
  }

  .btn {
    padding: 16px 32px;
    font-size: 16px;
    font-weight: 600;
    border: none;
    border-radius: 12px;
    cursor: pointer;
    text-decoration: none;
    transition: all 0.3s ease;
    display: inline-flex;
    align-items: center;
    gap: 8px;
    min-width: 150px;
    justify-content: center;
  }

  .btn-primary {
    background: linear-gradient(135deg, #667eea, #764ba2);
    color: white;
    box-shadow: 0 8px 25px rgba(102, 126, 234, 0.3);
  }

  .btn-primary:hover {
    transform: translateY(-3px);
    box-shadow: 0 15px 35px rgba(102, 126, 234, 0.4);
  }

  .btn-secondary {
    background: linear-gradient(135deg, #e2e8f0, #cbd5e1);
    color: #1e293b;
    box-shadow: 0 8px 25px rgba(0,0,0,0.1);
  }

  .btn-secondary:hover {
    transform: translateY(-3px);
    box-shadow: 0 15px 35px rgba(0,0,0,0.15);
  }

  .form-hint {
    font-size: 13px;
    color: #64748b;
    margin-top: 6px;
    display: flex;
    align-items: center;
    gap: 6px;
  }

  .success-animation {
    display: none;
    text-align: center;
    margin-top: 20px;
  }

  .checkmark {
    width: 60px;
    height: 60px;
    border-radius: 50%;
    display: block;
    stroke-width: 2;
    stroke: #10b981;
    stroke-miterlimit: 10;
    margin: 10px auto;
    box-shadow: inset 0px 0px 0px #10b981;
    animation: fill .4s ease-in-out .4s forwards, scale .3s ease-in-out .9s both;
  }

  .checkmark__circle {
    stroke-dasharray: 166;
    stroke-dashoffset: 166;
    stroke-width: 2;
    stroke-miterlimit: 10;
    stroke: #10b981;
    fill: none;
    animation: stroke 0.6s cubic-bezier(0.65, 0, 0.45, 1) forwards;
  }

  .checkmark__check {
    transform-origin: 50% 50%;
    stroke-dasharray: 48;
    stroke-dashoffset: 48;
    animation: stroke 0.3s cubic-bezier(0.65, 0, 0.45, 1) 0.8s forwards;
  }

  @keyframes stroke {
    100% { stroke-dashoffset: 0; }
  }

  @keyframes scale {
    0%, 100% { transform: none; }
    50% { transform: scale3d(1.1, 1.1, 1); }
  }

  @keyframes fill {
    100% { box-shadow: inset 0px 0px 0px 30px #10b981; }
  }

  .task-meta {
    background: #f8fafc;
    border-radius: 12px;
    padding: 20px;
    margin-bottom: 25px;
    border: 1px solid #e2e8f0;
  }

  .task-meta-item {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 10px;
  }

  .task-meta-item:last-child {
    margin-bottom: 0;
  }

  .meta-label {
    font-weight: 600;
    color: #64748b;
  }

  .meta-value {
    color: #1e293b;
  }

  @media (max-width: 768px) {
    .edit-task-container {
      padding: 10px;
    }

    .form-card {
      padding: 20px;
    }

    .form-row {
      grid-template-columns: 1fr;
    }

    .btn-container {
      flex-direction: column;
    }

    .page-title {
      font-size: 24px;
    }
  }
</style>

<div class="edit-task-container">
  <div class="page-header">
    <h2 class="page-title">‚úèÔ∏è Edit Task</h2>
  </div>

  <div class="form-card">
    <div class="task-meta">
      <div class="task-meta-item">
        <span class="meta-label">Task ID:</span>
        <span class="meta-value">#{{ task.id }}</span>
      </div>
      <div class="task-meta-item">
        <span class="meta-label">Created:</span>
        <span class="meta-value">{{ task.created_at.strftime('%B %d, %Y') if task.created_at else 'N/A' }}</span>
      </div>
      <div class="task-meta-item">
        <span class="meta-label">Project:</span>
        <span class="meta-value">{{ task.project.name if task.project else 'N/A' }}</span>
      </div>
    </div>

    <form method="POST" action="{{ url_for('manager.edit_task', task_id=task.id) }}" id="editTaskForm">
      <div class="form-grid">
        <div class="form-group">
          <label for="task_name">Task Name *</label>
          <input type="text" id="task_name" name="task_name" class="form-control" value="{{ task.task_name }}" required placeholder="Enter task name...">
          <div class="form-hint">üí° Choose a clear, descriptive name for this task</div>
        </div>

        <div class="form-group">
          <label for="summary">Summary</label>
          <input type="text" id="summary" name="summary" class="form-control" value="{{ task.summary or '' }}" placeholder="Brief summary of the task...">
          <div class="form-hint">üìù A one-line summary of what this task involves</div>
        </div>

        <div class="form-group">
          <label for="description">Description</label>
          <textarea id="description" name="description" class="form-control" rows="5" placeholder="Detailed description of the task requirements, goals, and any important notes...">{{ task.description or '' }}</textarea>
          <div class="form-hint">üìã Provide detailed information about requirements and expectations</div>
        </div>

        <div class="form-row">
          <div class="form-group priority-select">
            <label for="priority">Priority *</label>
            <select id="priority" name="priority" class="form-control" required onchange="updatePriorityIndicator(this.value)">
              {% for p in priorities %}
                <option value="{{ p.name }}" {% if task.priority.name == p.name %}selected{% endif %}>
                  {{ p.value.replace('_', ' ').title() }}
                </option>
              {% endfor %}
            </select>
            <div class="priority-indicator priority-{{ task.priority.name }}" id="priorityIndicator"></div>
            <div class="form-hint">üéØ Set the urgency level for this task</div>
          </div>

          <div class="form-group status-select">
            <label for="completion_status">Status *</label>
            <select id="completion_status" name="completion_status" class="form-control" required onchange="updateStatusIndicator(this.value)">
              {% for status in completion_statuses %}
                <option value="{{ status.name }}" {% if task.completion_status.name == status.name %}selected{% endif %}>
                  {{ status.value.replace('_', ' ').title() }}
                </option>
              {% endfor %}
            </select>
            <div class="status-indicator status-{{ task.completion_status.name }}" id="statusIndicator"></div>
            <div class="form-hint">üìä Current progress status of the task</div>
          </div>
        </div>

        <div class="form-group">
          <label for="due_date">Due Date</label>
          <div class="date-input-wrapper">
            <input type="date" id="due_date" name="due_date" class="form-control" value="{{ task.due_date or '' }}">
          </div>
          <div class="form-hint">‚è∞ Set a deadline for task completion</div>
        </div>
      </div>

      <div class="btn-container">
        <button type="submit" class="btn btn-primary" id="updateBtn">
          üíæ Update Task
        </button>
        <a href="{{ url_for('manager.view_project_details', project_id=task.project_id) }}" class="btn btn-secondary">
          ‚Ü©Ô∏è Back to Project
        </a>
      </div>
    </form>

    <div class="success-animation" id="successAnimation">
      <svg class="checkmark" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 52 52">
        <circle class="checkmark__circle" fill="none" cx="26" cy="26" r="25" stroke="#10b981"/>
        <path class="checkmark__check" fill="none" d="m14.1 27.2l7.1 7.2 16.7-16.8"/>
      </svg>
      <p style="color: #10b981; font-weight: 600;">Task Updated Successfully!</p>
    </div>
  </div>
</div>

<script>
  function updatePriorityIndicator(priority) {
    const indicator = document.getElementById('priorityIndicator');
    indicator.className = `priority-indicator priority-${priority}`;
  }

  function updateStatusIndicator(status) {
    const indicator = document.getElementById('statusIndicator');
    indicator.className = `status-indicator status-${status}`;
  }

  // Enhanced form submission with animation
  document.getElementById('editTaskForm').addEventListener('submit', function(e) {
    const updateBtn = document.getElementById('updateBtn');
    updateBtn.innerHTML = '‚è≥ Updating...';
    updateBtn.disabled = true;
    
    // If you want to show success animation instead of redirect:
    // e.preventDefault();
    // setTimeout(() => {
    //   document.querySelector('.form-card').style.display = 'none';
    //   document.getElementById('successAnimation').style.display = 'block';
    //   setTimeout(() => {
    //     window.location.href = "{{ url_for('manager.view_project_details', project_id=task.project_id) }}";
    //   }, 2000);
    // }, 1000);
  });

  // Auto-resize textarea
  document.getElementById('description').addEventListener('input', function() {
    this.style.height = 'auto';
    this.style.height = (this.scrollHeight) + 'px';
  });

  // Form validation enhancements
  document.getElementById('task_name').addEventListener('input', function() {
    if (this.value.trim().length < 3) {
      this.setCustomValidity('Task name must be at least 3 characters long');
    } else {
      this.setCustomValidity('');
    }
  });

  // Set minimum date to today
  document.getElementById('due_date').min = new Date().toISOString().split('T')[0];
</script>
{% endblock %}